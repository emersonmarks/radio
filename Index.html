<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R√°dios do Brasil - Vers√£o Corrigida</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #121212;
  color: #fff;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}
h1 { margin: 20px 0 10px 0; }
#playerContainer {
  position: sticky; top: 0; background: #1e1e1e;
  width: 100%; max-width: 600px; padding: 15px; border-radius: 8px;
  text-align: center; box-shadow: 0 0 10px #000; margin-bottom: 15px;
  display: none;
}
#currentLogo { width: 60px; height: 60px; object-fit: contain; background: #fff; border-radius: 8px; margin-bottom: 8px; }
audio { width: 100%; margin-top: 5px; }
#filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; justify-content: center; }
input, select, button {
  padding: 8px; border: none; border-radius: 4px; background: #1e1e1e; color: #fff;
}
button { background: #ff6f61; cursor: pointer; }
button:hover { background: #ff3b2f; }
#stations { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; width: 100%; max-width: 1200px; }
.station {
  background: #1e1e1e; border-radius: 8px; padding: 15px; text-align: center;
  transition: 0.3s; cursor: pointer;
}
.station:hover { background: #333; }
.station img { width: 80px; height: 80px; object-fit: contain; border-radius: 8px; background: #fff; margin-bottom: 10px; }
@media(max-width:600px){#filters{flex-direction:column;width:90%}input,select,button{width:100%}}
</style>
</head>
<body>

<h1>üéµ R√°dios do Brasil</h1>

<div id="playerContainer">
  <img id="currentLogo" src="" alt="Logo">
  <h3 id="currentStation"></h3>
  <audio id="radioPlayer" controls autoplay></audio>
</div>

<div id="filters">
  <input type="text" id="searchInput" placeholder="Buscar por nome...">
  <button onclick="applyFilters()">Buscar</button>
</div>

<div id="stations"><p>Carregando esta√ß√µes...</p></div>

<script>
const playerContainer = document.getElementById("playerContainer");
const player = document.getElementById("radioPlayer");
const currentLogo = document.getElementById("currentLogo");
const currentStation = document.getElementById("currentStation");

const PROXY = "https://api.allorigins.win/get?url=";
const SOURCES = [
  { name: "Stations.radioss.app", url: q => `https://stations.radioss.app/search?limit=20&q=${encodeURIComponent(q)}` },
  { name: "Radio Browser (NL1)", url: q => `https://nl1.api.radio-browser.info/json/stations/search?country=Brazil&limit=20&name=${encodeURIComponent(q)}` }
];

window.onload = () => fetchStations();

async function fetchStations(query = "") {
  const container = document.getElementById("stations");
  container.innerHTML = "<p>Carregando esta√ß√µes...</p>";

  for (const src of SOURCES) {
    try {
      const url = PROXY + encodeURIComponent(src.url(query || "Brazil"));
      const res = await fetch(url);
      if (!res.ok) throw new Error(res.status);
      const text = await res.text();
      const wrapped = JSON.parse(text);
      const data = JSON.parse(wrapped.contents);

      if (Array.isArray(data) && data.length > 0) {
        renderStations(data, src.name);
        return;
      }
    } catch (err) {
      console.warn("Erro em", src.name, err);
    }
  }

  container.innerHTML = "<p>‚ùå N√£o foi poss√≠vel carregar esta√ß√µes no momento. Tente novamente mais tarde.</p>";
}

function renderStations(stations, source) {
  const container = document.getElementById("stations");
  container.innerHTML = `<p style="color:#aaa;font-size:0.9em">Resultados via ${source}</p>`;
  stations.forEach(st => {
    const div = document.createElement("div");
    div.className = "station";
    div.innerHTML = `
      <img src="${st.favicon || 'https://via.placeholder.com/80?text=üéµ'}" alt="Logo">
      <h3>${st.name}</h3>
    `;
    div.onclick = () => playStation(st);
    container.appendChild(div);
  });
}

function playStation(st) {
  currentLogo.src = st.favicon || "https://via.placeholder.com/60?text=üéµ";
  currentStation.textContent = st.name;
  player.src = st.url_resolved || st.url || st.stream;
  player.play();
  playerContainer.style.display = "block";
}

function applyFilters() {
  const q = document.getElementById("searchInput").value.trim();
  fetchStations(q);
}
</script>
</body>
</html>
